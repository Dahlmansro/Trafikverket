
============================================================

============================================================
============================================================


============================================================
🚂 TÅGDATA PRODUCTION PIPELINE
============================================================


============================================================
============================================================
============================================================

Starttid: 2025-10-21 08:47:14

Mode: Full pipeline (3 steg)


============================================================
============================================================
============================================================

🚀 STEG: 1/3 - HÄMTA DATA FRÅN API

============================================================
============================================================

============================================================


============================================================

============================================================
============================================================

FETCH TRAIN DATA - START

============================================================
============================================================

============================================================


============================================================
============================================================
============================================================

🚂 HÄMTAR TÅGDATA FRÅN TRAFIKVERKET

============================================================
============================================================
============================================================

📅 Period: senaste 3 dagar (exkl. idag)

📅 Hämtar data för 2025-10-18
   [01/24] Hämtar 00:00–01:00... 1,438 rader
   [02/24] Hämtar 01:00–02:00... 931 rader
   [03/24] Hämtar 02:00–03:00... 429 rader
   [04/24] Hämtar 03:00–04:00... 146 rader
   [05/24] Hämtar 04:00–05:00... 140 rader
   [06/24] Hämtar 05:00–06:00... 693 rader
   [07/24] Hämtar 06:00–07:00... 1,420 rader
   [08/24] Hämtar 07:00–08:00... 1,905 rader
   [09/24] Hämtar 08:00–09:00... 2,423 rader
   [10/24] Hämtar 09:00–10:00... 2,782 rader
   [11/24] Hämtar 10:00–11:00... 2,861 rader
   [12/24] Hämtar 11:00–12:00... 2,841 rader
   [13/24] Hämtar 12:00–13:00... 2,821 rader
   [14/24] Hämtar 13:00–14:00... 2,807 rader
   [15/24] Hämtar 14:00–15:00... 2,822 rader
   [16/24] Hämtar 15:00–16:00... 2,769 rader
   [17/24] Hämtar 16:00–17:00... 2,863 rader
   [18/24] Hämtar 17:00–18:00... 2,899 rader
   [19/24] Hämtar 18:00–19:00... 2,722 rader
   [20/24] Hämtar 19:00–20:00... 2,500 rader
   [21/24] Hämtar 20:00–21:00... 2,316 rader
   [22/24] Hämtar 21:00–22:00... 2,132 rader
   [23/24] Hämtar 22:00–23:00... 1,981 rader
   [24/24] Hämtar 23:00–00:00... 1,729 rader
✅ Totalt 48,370 rader för 2025-10-18
📊 Separering: 24,247 departures, 24,123 arrivals
✅ Sparad till Azure: raw/departures_20251018.parquet (24,247 rader)
✅ Sparad till Azure: raw/arrivals_20251018.parquet (24,123 rader)

📅 Hämtar data för 2025-10-19
   [01/24] Hämtar 00:00–01:00... 1,356 rader
   [02/24] Hämtar 01:00–02:00... 1,112 rader
   [03/24] Hämtar 02:00–03:00... 571 rader
   [04/24] Hämtar 03:00–04:00... 243 rader
   [05/24] Hämtar 04:00–05:00... 287 rader
   [06/24] Hämtar 05:00–06:00... 922 rader
   [07/24] Hämtar 06:00–07:00... 1,718 rader
   [08/24] Hämtar 07:00–08:00... 2,370 rader
   [09/24] Hämtar 08:00–09:00... 3,289 rader
   [10/24] Hämtar 09:00–10:00... 4,036 rader
   [11/24] Hämtar 10:00–11:00... 4,330 rader
   [12/24] Hämtar 11:00–12:00... 4,459 rader
   [13/24] Hämtar 12:00–13:00... 4,611 rader
   [14/24] Hämtar 13:00–14:00... 4,582 rader
   [15/24] Hämtar 14:00–15:00... 4,904 rader
   [16/24] Hämtar 15:00–16:00... 4,789 rader
   [17/24] Hämtar 16:00–17:00... 4,949 rader
   [18/24] Hämtar 17:00–18:00... 5,159 rader
   [19/24] Hämtar 18:00–19:00... 5,145 rader
   [20/24] Hämtar 19:00–20:00... 4,978 rader
   [21/24] Hämtar 20:00–21:00... 4,653 rader
   [22/24] Hämtar 21:00–22:00... 4,200 rader
   [23/24] Hämtar 22:00–23:00... 3,576 rader
   [24/24] Hämtar 23:00–00:00... 2,685 rader
✅ Totalt 78,924 rader för 2025-10-19
📊 Separering: 53,977 departures, 24,947 arrivals
✅ Sparad till Azure: raw/departures_20251019.parquet (53,977 rader)
✅ Sparad till Azure: raw/arrivals_20251019.parquet (24,947 rader)

📅 Hämtar data för 2025-10-20
   [01/24] Hämtar 00:00–01:00... 1,421 rader
   [02/24] Hämtar 01:00–02:00... 373 rader
   [03/24] Hämtar 02:00–03:00... 126 rader
   [04/24] Hämtar 03:00–04:00... 165 rader
   [05/24] Hämtar 04:00–05:00... 895 rader
   [06/24] Hämtar 05:00–06:00... 3,956 rader
   [07/24] Hämtar 06:00–07:00... 6,598 rader
   [08/24] Hämtar 07:00–08:00... 7,402 rader
   [09/24] Hämtar 08:00–09:00... 7,105 rader
   [10/24] Hämtar 09:00–10:00... 6,329 rader
   [11/24] Hämtar 10:00–11:00... 5,596 rader
   [12/24] Hämtar 11:00–12:00... 5,598 rader
   [13/24] Hämtar 12:00–13:00... 5,511 rader
   [14/24] Hämtar 13:00–14:00... 5,669 rader
   [15/24] Hämtar 14:00–15:00... 6,033 rader
   [16/24] Hämtar 15:00–16:00... 6,649 rader
   [17/24] Hämtar 16:00–17:00... 7,331 rader
   [18/24] Hämtar 17:00–18:00... 7,433 rader
   [19/24] Hämtar 18:00–19:00... 6,870 rader
   [20/24] Hämtar 19:00–20:00... 5,875 rader
   [21/24] Hämtar 20:00–21:00... 5,324 rader
   [22/24] Hämtar 21:00–22:00... 4,698 rader
   [23/24] Hämtar 22:00–23:00... 3,861 rader
   [24/24] Hämtar 23:00–00:00... 2,838 rader
✅ Totalt 113,656 rader för 2025-10-20
📊 Separering: 77,766 departures, 35,890 arrivals
✅ Sparad till Azure: raw/departures_20251020.parquet (77,766 rader)
✅ Sparad till Azure: raw/arrivals_20251020.parquet (35,890 rader)

============================================================

============================================================
============================================================

📊 SAMMANFATTNING

============================================================
============================================================
============================================================

2025-10-18: ✅ Dep | ✅ Arr | 48,370 rader
2025-10-19: ✅ Dep | ✅ Arr | 78,924 rader
2025-10-20: ✅ Dep | ✅ Arr | 113,656 rader

✅ Lyckades: 3/3 dagar

============================================================
============================================================
============================================================

✅ ✅ FETCH KLART!

============================================================
============================================================

============================================================

✅ 
✅ 1/3 - HÄMTA DATA FRÅN API SLUTFÖRT

============================================================
============================================================
============================================================

🚀 STEG: 2/3 - PROCESSERA RAW → TRIPS

============================================================
============================================================

============================================================


============================================================
============================================================
============================================================

🚆 PROCESS TRIPS - START

============================================================
============================================================

============================================================

📋 Processerar senaste 3 dagarna: 20251018, 20251019, 20251020

📅 Processerar 20251018
   ✅ Läste raw/departures_20251018.parquet: 24,247 rader
   ✅ Läste raw/arrivals_20251018.parquet: 24,123 rader
   📊 Totalt RAW: 48,370 rader
   🔧 Flatten nested columns
   🔧 Skapade 10 kolumner från 4 nested-kolumner
   ✅ Extraherade trip_typeoftraffic från TypeOfTraffic_Code
   📅 Konverterar tidkolumner
   🗓️ Tilldelar TripDate
   🚆 Bygger resor per tåg-id och datum
   ✅ Totalt 2,213 resor skapade
   🔍 Enrichar med station_info
   🔍 Använder kolumn 'LocationSignature' från station_info för join
   Departure-join: 2213/2213 (100.0%) matchade
   Arrival-join: 2213/2213 (100.0%) matchade
   🏷️ Döper om kolumner
   📊 Separering: 2,213 huvudresor, 0 helt inställda
   ✅ Sparad: curated/trips_combined_20251018.parquet (2,213 resor)

📅 Processerar 20251019
   ✅ Läste raw/departures_20251019.parquet: 53,977 rader
   ✅ Läste raw/arrivals_20251019.parquet: 24,947 rader
   📊 Totalt RAW: 78,924 rader
   🔧 Flatten nested columns
   🔧 Skapade 10 kolumner från 4 nested-kolumner
   ✅ Extraherade trip_typeoftraffic från TypeOfTraffic_Code
   📅 Konverterar tidkolumner
   🗓️ Tilldelar TripDate
   🚆 Bygger resor per tåg-id och datum
   ✅ Totalt 2,232 resor skapade
   🔍 Enrichar med station_info
   🔍 Använder kolumn 'LocationSignature' från station_info för join
   Departure-join: 2232/2232 (100.0%) matchade
   Arrival-join: 2232/2232 (100.0%) matchade
   🏷️ Döper om kolumner
   📊 Separering: 2,232 huvudresor, 0 helt inställda
   ✅ Sparad: curated/trips_combined_20251019.parquet (2,232 resor)

📅 Processerar 20251020
   ✅ Läste raw/departures_20251020.parquet: 77,766 rader
   ✅ Läste raw/arrivals_20251020.parquet: 35,890 rader
   📊 Totalt RAW: 113,656 rader
   🔧 Flatten nested columns
   🔧 Skapade 10 kolumner från 4 nested-kolumner
   ✅ Extraherade trip_typeoftraffic från TypeOfTraffic_Code
   📅 Konverterar tidkolumner
   🗓️ Tilldelar TripDate
   🚆 Bygger resor per tåg-id och datum
   ✅ Totalt 3,395 resor skapade
   🔍 Enrichar med station_info
   🔍 Använder kolumn 'LocationSignature' från station_info för join
   Departure-join: 3395/3395 (100.0%) matchade
   Arrival-join: 3395/3395 (100.0%) matchade
   🏷️ Döper om kolumner
   📊 Separering: 3,395 huvudresor, 0 helt inställda
   ✅ Sparad: curated/trips_combined_20251020.parquet (3,395 resor)

============================================================

============================================================
============================================================

📊 SAMMANFATTNING

============================================================
============================================================
============================================================

✅ 20251018
✅ 20251019
✅ 20251020

✅ Lyckades: 3/3

============================================================
============================================================
============================================================

✅ ✅ PROCESS TRIPS KLART!

============================================================
============================================================

============================================================

✅ 
✅ 2/3 - PROCESSERA RAW → TRIPS SLUTFÖRT

============================================================
============================================================
============================================================

🚀 STEG: 3/3 - KOMBINERA ALLA TRIPS

============================================================
============================================================

============================================================


============================================================
============================================================
============================================================

🔗 COMBINE ALL TRIPS - START

============================================================
============================================================

============================================================

🔍 Söker efter trips_combined_*.parquet filer...
✅ Hittade 8 filer:
   - curated/trips_combined_20251013.parquet
   - curated/trips_combined_20251014.parquet
   - curated/trips_combined_20251015.parquet
   - curated/trips_combined_20251016.parquet
   - curated/trips_combined_20251017.parquet
   - curated/trips_combined_20251018.parquet
   - curated/trips_combined_20251019.parquet
   - curated/trips_combined_20251020.parquet

📥 Läser 8 filer...
   [1/8] ✅ trips_combined_20251013.parquet: 8,628 rader
   [2/8] ✅ trips_combined_20251014.parquet: 3,388 rader
   [3/8] ✅ trips_combined_20251015.parquet: 7,394 rader
   [4/8] ✅ trips_combined_20251016.parquet: 3,341 rader
   [5/8] ✅ trips_combined_20251017.parquet: 3,317 rader
   [6/8] ✅ trips_combined_20251018.parquet: 2,213 rader
   [7/8] ✅ trips_combined_20251019.parquet: 2,232 rader
   [8/8] ✅ trips_combined_20251020.parquet: 3,395 rader

🔗 Concatenerar 8 DataFrames...
✅ Total före filtrering: 33,908 rader

🧹 Filtrerar dubbletter på (AdvertisedTrainIdent, TripStartDate)...
✅ Efter filtrering: 29,374 rader
🗑️  Borttagna dubbletter: 4,534 (13.4%)
✅ Sorterad på TripStartDate och AdvertisedTrainIdent

💾 Sparar till curated/trips_combined_total.parquet...
✅ Sparad till Azure: curated/trips_combined_total.parquet

============================================================

============================================================
============================================================

📊 STATISTIK

============================================================
============================================================
============================================================

Totalt antal resor: 29,374
Datumspann: 2025-10-09 till 2025-10-20
Antal unika dagar: 12
Antal unika tåg-id: 4,004
Antal försenade resor: 5,539 (18.9%)

============================================================
============================================================
============================================================

✅ ✅ COMBINE ALL TRIPS KLART!

============================================================
============================================================

============================================================

✅ 
✅ 3/3 - KOMBINERA ALLA TRIPS SLUTFÖRT

============================================================

============================================================
============================================================

📊 PIPELINE SAMMANFATTNING

============================================================
============================================================
============================================================

✅ Steg 1 (Fetch):   LYCKADES
✅ Steg 2 (Process): LYCKADES
✅ Steg 3 (Combine): LYCKADES

Tid: 175.4 sekunder
Sluttid: 2025-10-21 08:50:09

============================================================
============================================================
============================================================

✅ ✅ HELA PIPELINE SLUTFÖRD FRAMGÅNGSRIKT!

============================================================
============================================================

============================================================

