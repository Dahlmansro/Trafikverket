
============================================================

============================================================
============================================================


============================================================
🚂 TÅGDATA PRODUCTION PIPELINE
============================================================


============================================================
============================================================
============================================================

Starttid: 2025-10-22 16:30:36

Mode: Full pipeline (3 steg)


============================================================
============================================================
============================================================

🚀 STEG: 1/3 - HÄMTA DATA FRÅN API

============================================================
============================================================

============================================================


============================================================

============================================================
============================================================

FETCH TRAIN DATA - START

============================================================
============================================================

============================================================


============================================================
============================================================
============================================================

🚂 HÄMTAR TÅGDATA FRÅN TRAFIKVERKET

============================================================
============================================================
============================================================

📅 Period: senaste 3 dagar (exkl. idag)

📅 Hämtar data för 2025-10-19
   [01/24] Hämtar 00:00–01:00... 0 rader
   [02/24] Hämtar 01:00–02:00... 0 rader
   [03/24] Hämtar 02:00–03:00... 0 rader
   [04/24] Hämtar 03:00–04:00... 0 rader
   [05/24] Hämtar 04:00–05:00... 0 rader
   [06/24] Hämtar 05:00–06:00... 0 rader
   [07/24] Hämtar 06:00–07:00... 0 rader
   [08/24] Hämtar 07:00–08:00... 0 rader
   [09/24] Hämtar 08:00–09:00... 1 rader
   [10/24] Hämtar 09:00–10:00... 1 rader
   [11/24] Hämtar 10:00–11:00... 0 rader
   [12/24] Hämtar 11:00–12:00... 1 rader
   [13/24] Hämtar 12:00–13:00... 9 rader
   [14/24] Hämtar 13:00–14:00... 6 rader
   [15/24] Hämtar 14:00–15:00... 7 rader
   [16/24] Hämtar 15:00–16:00... 4 rader
   [17/24] Hämtar 16:00–17:00... 1 rader
   [18/24] Hämtar 17:00–18:00... 7 rader
   [19/24] Hämtar 18:00–19:00... 5 rader
   [20/24] Hämtar 19:00–20:00... 2 rader
   [21/24] Hämtar 20:00–21:00... 4 rader
   [22/24] Hämtar 21:00–22:00... 3 rader
   [23/24] Hämtar 22:00–23:00... 2 rader
   [24/24] Hämtar 23:00–00:00... 4 rader
✅ Totalt 57 rader för 2025-10-19
📊 Separering: 53 departures, 4 arrivals
✅ Sparad till Azure: raw/departures_20251019.parquet (53 rader)
✅ Sparad till Azure: raw/arrivals_20251019.parquet (4 rader)

📅 Hämtar data för 2025-10-20
   [01/24] Hämtar 00:00–01:00... 270 rader
   [02/24] Hämtar 01:00–02:00... 284 rader
   [03/24] Hämtar 02:00–03:00... 112 rader
   [04/24] Hämtar 03:00–04:00... 150 rader
   [05/24] Hämtar 04:00–05:00... 880 rader
   [06/24] Hämtar 05:00–06:00... 3,945 rader
   [07/24] Hämtar 06:00–07:00... 6,587 rader
   [08/24] Hämtar 07:00–08:00... 7,393 rader
   [09/24] Hämtar 08:00–09:00... 7,099 rader
   [10/24] Hämtar 09:00–10:00... 6,319 rader
   [11/24] Hämtar 10:00–11:00... 5,589 rader
   [12/24] Hämtar 11:00–12:00... 5,579 rader
   [13/24] Hämtar 12:00–13:00... 5,511 rader
   [14/24] Hämtar 13:00–14:00... 5,669 rader
   [15/24] Hämtar 14:00–15:00... 6,033 rader
   [16/24] Hämtar 15:00–16:00... 6,649 rader
   [17/24] Hämtar 16:00–17:00... 7,331 rader
   [18/24] Hämtar 17:00–18:00... 7,433 rader
   [19/24] Hämtar 18:00–19:00... 6,870 rader
   [20/24] Hämtar 19:00–20:00... 5,875 rader
   [21/24] Hämtar 20:00–21:00... 5,324 rader
   [22/24] Hämtar 21:00–22:00... 4,698 rader
   [23/24] Hämtar 22:00–23:00... 3,861 rader
   [24/24] Hämtar 23:00–00:00... 2,838 rader
✅ Totalt 112,299 rader för 2025-10-20
📊 Separering: 76,868 departures, 35,431 arrivals
✅ Sparad till Azure: raw/departures_20251020.parquet (76,868 rader)
✅ Sparad till Azure: raw/arrivals_20251020.parquet (35,431 rader)

📅 Hämtar data för 2025-10-21
   [01/24] Hämtar 00:00–01:00... 1,577 rader
   [02/24] Hämtar 01:00–02:00... 426 rader
   [03/24] Hämtar 02:00–03:00... 128 rader
   [04/24] Hämtar 03:00–04:00... 163 rader
   [05/24] Hämtar 04:00–05:00... 908 rader
   [06/24] Hämtar 05:00–06:00... 3,941 rader
   [07/24] Hämtar 06:00–07:00... 6,573 rader
   [08/24] Hämtar 07:00–08:00... 7,395 rader
   [09/24] Hämtar 08:00–09:00... 7,106 rader
   [10/24] Hämtar 09:00–10:00... 6,289 rader
   [11/24] Hämtar 10:00–11:00... 5,557 rader
   [12/24] Hämtar 11:00–12:00... 5,584 rader
   [13/24] Hämtar 12:00–13:00... 5,525 rader
   [14/24] Hämtar 13:00–14:00... 5,697 rader
   [15/24] Hämtar 14:00–15:00... 6,060 rader
   [16/24] Hämtar 15:00–16:00... 6,727 rader
   [17/24] Hämtar 16:00–17:00... 7,366 rader
   [18/24] Hämtar 17:00–18:00... 7,510 rader
   [19/24] Hämtar 18:00–19:00... 6,896 rader
   [20/24] Hämtar 19:00–20:00... 5,884 rader
   [21/24] Hämtar 20:00–21:00... 5,343 rader
   [22/24] Hämtar 21:00–22:00... 4,718 rader
   [23/24] Hämtar 22:00–23:00... 3,865 rader
   [24/24] Hämtar 23:00–00:00... 2,842 rader
✅ Totalt 114,080 rader för 2025-10-21
📊 Separering: 78,056 departures, 36,024 arrivals
✅ Sparad till Azure: raw/departures_20251021.parquet (78,056 rader)
✅ Sparad till Azure: raw/arrivals_20251021.parquet (36,024 rader)

============================================================

============================================================
============================================================

📊 SAMMANFATTNING

============================================================
============================================================
============================================================

2025-10-19: ✅ Dep | ✅ Arr | 57 rader
2025-10-20: ✅ Dep | ✅ Arr | 112,299 rader
2025-10-21: ✅ Dep | ✅ Arr | 114,080 rader

✅ Lyckades: 3/3 dagar

============================================================
============================================================
============================================================

✅ ✅ FETCH KLART!

============================================================
============================================================

============================================================

✅ 
✅ 1/3 - HÄMTA DATA FRÅN API SLUTFÖRT

============================================================
============================================================
============================================================

🚀 STEG: 2/3 - PROCESSERA RAW → TRIPS

============================================================
============================================================

============================================================


============================================================
============================================================
============================================================

🚆 PROCESS TRIPS - START

============================================================
============================================================

============================================================

📋 Processerar senaste 3 dagarna: 20251019, 20251020, 20251021

📅 Processerar 20251019
   ✅ Läste raw/departures_20251019.parquet: 53 rader
   ✅ Läste raw/arrivals_20251019.parquet: 4 rader
   📊 Totalt RAW: 57 rader
   🔧 Flatten nested columns
   📅 Konverterar tidkolumner
   🗓️ Tilldelar TripDate
   🚆 Bygger resor per tåg-id och datum
⚠️     ⚠️ Inga resor kunde skapas från rådata!
⚠️     ⚠️ Inga trips kunde byggas för 20251019

📅 Processerar 20251020
   ✅ Läste raw/departures_20251020.parquet: 76,868 rader
   ✅ Läste raw/arrivals_20251020.parquet: 35,431 rader
   📊 Totalt RAW: 112,299 rader
   🔧 Flatten nested columns
   🔧 Skapade 10 kolumner från 4 nested-kolumner
   ✅ Extraherade trip_typeoftraffic från TypeOfTraffic_Code
   📅 Konverterar tidkolumner
   🗓️ Tilldelar TripDate
   🚆 Bygger resor per tåg-id och datum
   ✅ Totalt 3,335 resor skapade
   🔍 Enrichar med station_info
   🔍 Använder kolumn 'LocationSignature' från station_info för join
   Departure-join: 3335/3335 (100.0%) matchade
   Arrival-join: 3335/3335 (100.0%) matchade
   🏷️ Döper om kolumner
   📊 Separering: 3,335 huvudresor, 0 helt inställda
   ✅ Sparad: curated/trips_combined_20251020.parquet (3,335 resor)

📅 Processerar 20251021
   ✅ Läste raw/departures_20251021.parquet: 78,056 rader
   ✅ Läste raw/arrivals_20251021.parquet: 36,024 rader
   📊 Totalt RAW: 114,080 rader
   🔧 Flatten nested columns
   🔧 Skapade 10 kolumner från 4 nested-kolumner
   ✅ Extraherade trip_typeoftraffic från TypeOfTraffic_Code
   📅 Konverterar tidkolumner
   🗓️ Tilldelar TripDate
   🚆 Bygger resor per tåg-id och datum
   ✅ Totalt 3,397 resor skapade
   🔍 Enrichar med station_info
   🔍 Använder kolumn 'LocationSignature' från station_info för join
   Departure-join: 3397/3397 (100.0%) matchade
   Arrival-join: 3397/3397 (100.0%) matchade
   🏷️ Döper om kolumner
   📊 Separering: 3,397 huvudresor, 0 helt inställda
   ✅ Sparad: curated/trips_combined_20251021.parquet (3,397 resor)

============================================================

============================================================
============================================================

📊 SAMMANFATTNING

============================================================
============================================================
============================================================

❌ 20251019
✅ 20251020
✅ 20251021

✅ Lyckades: 2/3

============================================================
============================================================
============================================================

✅ ✅ PROCESS TRIPS KLART!

============================================================
============================================================

============================================================

✅ 
✅ 2/3 - PROCESSERA RAW → TRIPS SLUTFÖRT

============================================================
============================================================
============================================================

🚀 STEG: 3/3 - KOMBINERA ALLA TRIPS

============================================================
============================================================

============================================================


============================================================
============================================================
============================================================

🔗 COMBINE ALL TRIPS - START

============================================================
============================================================

============================================================

🔍 Söker efter trips_combined_*.parquet filer...
✅ Hittade 9 filer:
   - curated/trips_combined_20251013.parquet
   - curated/trips_combined_20251014.parquet
   - curated/trips_combined_20251015.parquet
   - curated/trips_combined_20251016.parquet
   - curated/trips_combined_20251017.parquet
   - curated/trips_combined_20251018.parquet
   - curated/trips_combined_20251019.parquet
   - curated/trips_combined_20251020.parquet
   - curated/trips_combined_20251021.parquet

📥 Läser 9 filer...
   [1/9] ✅ trips_combined_20251013.parquet: 8,628 rader
   [2/9] ✅ trips_combined_20251014.parquet: 3,388 rader
   [3/9] ✅ trips_combined_20251015.parquet: 7,394 rader
   [4/9] ✅ trips_combined_20251016.parquet: 3,341 rader
   [5/9] ✅ trips_combined_20251017.parquet: 3,317 rader
   [6/9] ✅ trips_combined_20251018.parquet: 2,213 rader
   [7/9] ✅ trips_combined_20251019.parquet: 2,232 rader
   [8/9] ✅ trips_combined_20251020.parquet: 3,335 rader
   [9/9] ✅ trips_combined_20251021.parquet: 3,397 rader

🔗 Concatenerar 9 DataFrames...
✅ Total före filtrering: 37,245 rader

🧹 Filtrerar dubbletter på (AdvertisedTrainIdent, TripStartDate)...
✅ Efter filtrering: 32,698 rader
🗑️  Borttagna dubbletter: 4,547 (12.2%)
✅ Sorterad på TripStartDate och AdvertisedTrainIdent

💾 Sparar till curated/trips_combined_total.parquet...
✅ Sparad till Azure: curated/trips_combined_total.parquet

============================================================

============================================================
============================================================

📊 STATISTIK

============================================================
============================================================
============================================================

Totalt antal resor: 32,698
Datumspann: 2025-10-09 till 2025-10-21
Antal unika dagar: 13
Antal unika tåg-id: 4,008
Antal försenade resor: 6,343 (19.4%)

============================================================
============================================================
============================================================

✅ ✅ COMBINE ALL TRIPS KLART!

============================================================
============================================================

============================================================

✅ 
✅ 3/3 - KOMBINERA ALLA TRIPS SLUTFÖRT

============================================================

============================================================
============================================================

📊 PIPELINE SAMMANFATTNING

============================================================
============================================================
============================================================

✅ Steg 1 (Fetch):   LYCKADES
✅ Steg 2 (Process): LYCKADES
✅ Steg 3 (Combine): LYCKADES

Tid: 124.6 sekunder
Sluttid: 2025-10-22 16:32:41

============================================================
============================================================
============================================================

✅ ✅ HELA PIPELINE SLUTFÖRD FRAMGÅNGSRIKT!

============================================================
============================================================

============================================================

