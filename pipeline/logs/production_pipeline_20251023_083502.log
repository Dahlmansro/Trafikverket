
============================================================

============================================================
============================================================


============================================================
🚂 TÅGDATA PRODUCTION PIPELINE
============================================================


============================================================
============================================================
============================================================

Starttid: 2025-10-23 08:35:02

Mode: Full pipeline (3 steg)


============================================================
============================================================
============================================================

🚀 STEG: 1/3 - HÄMTA DATA FRÅN API

============================================================
============================================================

============================================================


============================================================

============================================================
============================================================

FETCH TRAIN DATA - START

============================================================
============================================================

============================================================


============================================================
============================================================
============================================================

🚂 HÄMTAR TÅGDATA FRÅN TRAFIKVERKET

============================================================
============================================================
============================================================

📅 Period: senaste 3 dagar (exkl. idag)

📅 Hämtar data för 2025-10-20
   [01/24] Hämtar 00:00–01:00... 2 rader
   [02/24] Hämtar 01:00–02:00... 0 rader
   [03/24] Hämtar 02:00–03:00... 0 rader
   [04/24] Hämtar 03:00–04:00... 0 rader
   [05/24] Hämtar 04:00–05:00... 0 rader
   [06/24] Hämtar 05:00–06:00... 1 rader
   [07/24] Hämtar 06:00–07:00... 4 rader
   [08/24] Hämtar 07:00–08:00... 7 rader
   [09/24] Hämtar 08:00–09:00... 3 rader
   [10/24] Hämtar 09:00–10:00... 5 rader
   [11/24] Hämtar 10:00–11:00... 1 rader
   [12/24] Hämtar 11:00–12:00... 1 rader
   [13/24] Hämtar 12:00–13:00... 12 rader
   [14/24] Hämtar 13:00–14:00... 7 rader
   [15/24] Hämtar 14:00–15:00... 5 rader
   [16/24] Hämtar 15:00–16:00... 6 rader
   [17/24] Hämtar 16:00–17:00... 17 rader
   [18/24] Hämtar 17:00–18:00... 16 rader
   [19/24] Hämtar 18:00–19:00... 18 rader
   [20/24] Hämtar 19:00–20:00... 22 rader
   [21/24] Hämtar 20:00–21:00... 5 rader
   [22/24] Hämtar 21:00–22:00... 12 rader
   [23/24] Hämtar 22:00–23:00... 5 rader
   [24/24] Hämtar 23:00–00:00... 9 rader
✅ Totalt 158 rader för 2025-10-20
📊 Separering: 154 departures, 4 arrivals
✅ Sparad till Azure: raw/departures_20251020.parquet (154 rader)
✅ Sparad till Azure: raw/arrivals_20251020.parquet (4 rader)

📅 Hämtar data för 2025-10-21
   [01/24] Hämtar 00:00–01:00... 334 rader
   [02/24] Hämtar 01:00–02:00... 297 rader
   [03/24] Hämtar 02:00–03:00... 117 rader
   [04/24] Hämtar 03:00–04:00... 148 rader
   [05/24] Hämtar 04:00–05:00... 893 rader
   [06/24] Hämtar 05:00–06:00... 3,927 rader
   [07/24] Hämtar 06:00–07:00... 6,560 rader
   [08/24] Hämtar 07:00–08:00... 7,381 rader
   [09/24] Hämtar 08:00–09:00... 7,099 rader
   [10/24] Hämtar 09:00–10:00... 6,281 rader
   [11/24] Hämtar 10:00–11:00... 5,552 rader
   [12/24] Hämtar 11:00–12:00... 5,572 rader
   [13/24] Hämtar 12:00–13:00... 5,525 rader
   [14/24] Hämtar 13:00–14:00... 5,697 rader
   [15/24] Hämtar 14:00–15:00... 6,060 rader
   [16/24] Hämtar 15:00–16:00... 6,727 rader
   [17/24] Hämtar 16:00–17:00... 7,366 rader
   [18/24] Hämtar 17:00–18:00... 7,510 rader
   [19/24] Hämtar 18:00–19:00... 6,896 rader
   [20/24] Hämtar 19:00–20:00... 5,884 rader
   [21/24] Hämtar 20:00–21:00... 5,343 rader
   [22/24] Hämtar 21:00–22:00... 4,718 rader
   [23/24] Hämtar 22:00–23:00... 3,865 rader
   [24/24] Hämtar 23:00–00:00... 2,842 rader
✅ Totalt 112,594 rader för 2025-10-21
📊 Separering: 77,115 departures, 35,479 arrivals
✅ Sparad till Azure: raw/departures_20251021.parquet (77,115 rader)
✅ Sparad till Azure: raw/arrivals_20251021.parquet (35,479 rader)

📅 Hämtar data för 2025-10-22
   [01/24] Hämtar 00:00–01:00... 1,577 rader
   [02/24] Hämtar 01:00–02:00... 424 rader
   [03/24] Hämtar 02:00–03:00... 135 rader
   [04/24] Hämtar 03:00–04:00... 160 rader
   [05/24] Hämtar 04:00–05:00... 902 rader
   [06/24] Hämtar 05:00–06:00... 3,922 rader
   [07/24] Hämtar 06:00–07:00... 6,539 rader
   [08/24] Hämtar 07:00–08:00... 7,311 rader
   [09/24] Hämtar 08:00–09:00... 7,074 rader
   [10/24] Hämtar 09:00–10:00... 6,310 rader
   [11/24] Hämtar 10:00–11:00... 5,577 rader
   [12/24] Hämtar 11:00–12:00... 5,584 rader
   [13/24] Hämtar 12:00–13:00... 5,531 rader
   [14/24] Hämtar 13:00–14:00... 5,683 rader
   [15/24] Hämtar 14:00–15:00... 6,032 rader
   [16/24] Hämtar 15:00–16:00... 6,710 rader
   [17/24] Hämtar 16:00–17:00... 7,362 rader
   [18/24] Hämtar 17:00–18:00... 7,504 rader
   [19/24] Hämtar 18:00–19:00... 6,902 rader
   [20/24] Hämtar 19:00–20:00... 5,892 rader
   [21/24] Hämtar 20:00–21:00... 5,362 rader
   [22/24] Hämtar 21:00–22:00... 4,714 rader
   [23/24] Hämtar 22:00–23:00... 3,840 rader
   [24/24] Hämtar 23:00–00:00... 2,823 rader
✅ Totalt 113,870 rader för 2025-10-22
📊 Separering: 77,901 departures, 35,969 arrivals
✅ Sparad till Azure: raw/departures_20251022.parquet (77,901 rader)
✅ Sparad till Azure: raw/arrivals_20251022.parquet (35,969 rader)

============================================================

============================================================
============================================================

📊 SAMMANFATTNING

============================================================
============================================================
============================================================

2025-10-20: ✅ Dep | ✅ Arr | 158 rader
2025-10-21: ✅ Dep | ✅ Arr | 112,594 rader
2025-10-22: ✅ Dep | ✅ Arr | 113,870 rader

✅ Lyckades: 3/3 dagar

============================================================
============================================================
============================================================

✅ ✅ FETCH KLART!

============================================================
============================================================

============================================================

✅ 
✅ 1/3 - HÄMTA DATA FRÅN API SLUTFÖRT

============================================================
============================================================
============================================================

🚀 STEG: 2/3 - PROCESSERA RAW → TRIPS

============================================================
============================================================

============================================================


============================================================
============================================================
============================================================

🚆 PROCESS TRIPS - START

============================================================
============================================================

============================================================

📋 Processerar senaste 3 dagarna: 20251020, 20251021, 20251022

📅 Processerar 20251020
   ✅ Läste raw/departures_20251020.parquet: 154 rader
   ✅ Läste raw/arrivals_20251020.parquet: 4 rader
   📊 Totalt RAW: 158 rader
   🔧 Flatten nested columns
   📅 Konverterar tidkolumner
   🗓️ Tilldelar TripDate
   🚆 Bygger resor per tåg-id och datum
   ✅ Totalt 3 resor skapade
   🔍 Enrichar med station_info
   🔍 Använder kolumn 'LocationSignature' från station_info för join
   Departure-join: 3/3 (100.0%) matchade
   Arrival-join: 3/3 (100.0%) matchade
   🏷️ Döper om kolumner
   📊 Separering: 3 huvudresor, 0 helt inställda
   ✅ Sparad: curated/trips_combined_20251020.parquet (3 resor)

📅 Processerar 20251021
   ✅ Läste raw/departures_20251021.parquet: 77,115 rader
   ✅ Läste raw/arrivals_20251021.parquet: 35,479 rader
   📊 Totalt RAW: 112,594 rader
   🔧 Flatten nested columns
   🔧 Skapade 10 kolumner från 4 nested-kolumner
   ✅ Extraherade trip_typeoftraffic från TypeOfTraffic_Code
   📅 Konverterar tidkolumner
   🗓️ Tilldelar TripDate
   🚆 Bygger resor per tåg-id och datum
   ✅ Totalt 3,331 resor skapade
   🔍 Enrichar med station_info
   🔍 Använder kolumn 'LocationSignature' från station_info för join
   Departure-join: 3331/3331 (100.0%) matchade
   Arrival-join: 3331/3331 (100.0%) matchade
   🏷️ Döper om kolumner
   📊 Separering: 3,331 huvudresor, 0 helt inställda
   ✅ Sparad: curated/trips_combined_20251021.parquet (3,331 resor)

📅 Processerar 20251022
   ✅ Läste raw/departures_20251022.parquet: 77,901 rader
   ✅ Läste raw/arrivals_20251022.parquet: 35,969 rader
   📊 Totalt RAW: 113,870 rader
   🔧 Flatten nested columns
   🔧 Skapade 10 kolumner från 4 nested-kolumner
   ✅ Extraherade trip_typeoftraffic från TypeOfTraffic_Code
   📅 Konverterar tidkolumner
   🗓️ Tilldelar TripDate
   🚆 Bygger resor per tåg-id och datum
   ✅ Totalt 3,394 resor skapade
   🔍 Enrichar med station_info
   🔍 Använder kolumn 'LocationSignature' från station_info för join
   Departure-join: 3394/3394 (100.0%) matchade
   Arrival-join: 3394/3394 (100.0%) matchade
   🏷️ Döper om kolumner
   📊 Separering: 3,394 huvudresor, 0 helt inställda
   ✅ Sparad: curated/trips_combined_20251022.parquet (3,394 resor)

============================================================

============================================================
============================================================

📊 SAMMANFATTNING

============================================================
============================================================
============================================================

✅ 20251020
✅ 20251021
✅ 20251022

✅ Lyckades: 3/3

============================================================
============================================================
============================================================

✅ ✅ PROCESS TRIPS KLART!

============================================================
============================================================

============================================================

✅ 
✅ 2/3 - PROCESSERA RAW → TRIPS SLUTFÖRT

============================================================
============================================================
============================================================

🚀 STEG: 3/3 - KOMBINERA ALLA TRIPS

============================================================
============================================================

============================================================


============================================================
============================================================
============================================================

🔗 COMBINE ALL TRIPS - START

============================================================
============================================================

============================================================

🔍 Söker efter trips_combined_*.parquet filer...
✅ Hittade 10 filer:
   - curated/trips_combined_20251013.parquet
   - curated/trips_combined_20251014.parquet
   - curated/trips_combined_20251015.parquet
   - curated/trips_combined_20251016.parquet
   - curated/trips_combined_20251017.parquet
   - curated/trips_combined_20251018.parquet
   - curated/trips_combined_20251019.parquet
   - curated/trips_combined_20251020.parquet
   - curated/trips_combined_20251021.parquet
   - curated/trips_combined_20251022.parquet

📥 Läser 10 filer...
   [1/10] ✅ trips_combined_20251013.parquet: 8,628 rader
   [2/10] ✅ trips_combined_20251014.parquet: 3,388 rader
   [3/10] ✅ trips_combined_20251015.parquet: 7,394 rader
   [4/10] ✅ trips_combined_20251016.parquet: 3,341 rader
   [5/10] ✅ trips_combined_20251017.parquet: 3,317 rader
   [6/10] ✅ trips_combined_20251018.parquet: 2,213 rader
   [7/10] ✅ trips_combined_20251019.parquet: 2,232 rader
   [8/10] ✅ trips_combined_20251020.parquet: 3 rader
   [9/10] ✅ trips_combined_20251021.parquet: 3,331 rader
   [10/10] ✅ trips_combined_20251022.parquet: 3,394 rader

🔗 Concatenerar 10 DataFrames...
✅ Total före filtrering: 37,241 rader

🧹 Filtrerar dubbletter på (AdvertisedTrainIdent, TripStartDate)...
✅ Efter filtrering: 32,704 rader
🗑️  Borttagna dubbletter: 4,537 (12.2%)
✅ Sorterad på TripStartDate och AdvertisedTrainIdent

💾 Sparar till curated/trips_combined_total.parquet...
✅ Sparad till Azure: curated/trips_combined_total.parquet

============================================================

============================================================
============================================================

📊 STATISTIK

============================================================
============================================================
============================================================

Totalt antal resor: 32,704
Datumspann: 2025-10-09 till 2025-10-22
Antal unika dagar: 14
Antal unika tåg-id: 4,004
Antal försenade resor: 6,349 (19.4%)

============================================================
============================================================
============================================================

✅ ✅ COMBINE ALL TRIPS KLART!

============================================================
============================================================

============================================================

✅ 
✅ 3/3 - KOMBINERA ALLA TRIPS SLUTFÖRT

============================================================

============================================================
============================================================

📊 PIPELINE SAMMANFATTNING

============================================================
============================================================
============================================================

✅ Steg 1 (Fetch):   LYCKADES
✅ Steg 2 (Process): LYCKADES
✅ Steg 3 (Combine): LYCKADES

Tid: 126.2 sekunder
Sluttid: 2025-10-23 08:37:08

============================================================
============================================================
============================================================

✅ ✅ HELA PIPELINE SLUTFÖRD FRAMGÅNGSRIKT!

============================================================
============================================================

============================================================

